--// Bee Swarm Simulator - ServerScriptService Script
--// Author: You

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local ServerStorage = game:GetService("ServerStorage")

-- Remotes
local RemotesFolder = ReplicatedStorage:WaitForChild("Remotes")
local CollectHoneyEvent = RemotesFolder:WaitForChild("CollectHoney")
local SpawnBeeEvent = RemotesFolder:WaitForChild("SpawnBee")
local ConvertPollenEvent = RemotesFolder:WaitForChild("ConvertPollen")

-- Settings
local CONVERT_RATE = 0.5 -- how much pollen turns into honey per tick
local CONVERT_INTERVAL = 0.5 -- seconds between conversions

------------------------------------------------------
-- Helper functions
------------------------------------------------------

-- Create leaderstats for player if not already present
local function setupLeaderstats(player)
	local stats = player:FindFirstChild("leaderstats")
	if not stats then
		stats = Instance.new("Folder")
		stats.Name = "leaderstats"
		stats.Parent = player
	end

	local honey = stats:FindFirstChild("Honey") or Instance.new("IntValue")
	honey.Name = "Honey"
	honey.Value = honey.Value or 0
	honey.Parent = stats

	local pollen = stats:FindFirstChild("Pollen") or Instance.new("IntValue")
	pollen.Name = "Pollen"
	pollen.Value = pollen.Value or 0
	pollen.Parent = stats
end

-- When player joins, setup stats
Players.PlayerAdded:Connect(setupLeaderstats)

------------------------------------------------------
-- RemoteEvent: CollectHoney
------------------------------------------------------
CollectHoneyEvent.OnServerEvent:Connect(function(player, amount)
	if typeof(amount) ~= "number" then return end

	local stats = player:FindFirstChild("leaderstats")
	if not stats then return end

	local honey = stats:FindFirstChild("Honey")
	if honey then
		honey.Value += math.floor(amount)
	end
end)

------------------------------------------------------
-- RemoteEvent: SpawnBee
------------------------------------------------------
SpawnBeeEvent.OnServerEvent:Connect(function(player)
	-- Check for a bee model in ServerStorage
	local beeModel = ServerStorage:FindFirstChild("Bee")
	if not beeModel then
		warn("No bee model found in ServerStorage!")
		return
	end

	-- Clone and parent to workspace
	local newBee = beeModel:Clone()
	newBee.Name = player.Name .. "_Bee"
	newBee.Parent = workspace

	-- Optionally set a spawn position
	newBee:MoveTo(player.Character and player.Character:GetPrimaryPartCFrame().p + Vector3.new(5, 0, 0) or Vector3.zero)
end)

------------------------------------------------------
-- RemoteEvent: ConvertPollen
------------------------------------------------------
ConvertPollenEvent.OnServerEvent:Connect(function(player)
	local stats = player:FindFirstChild("leaderstats")
	if not stats then return end

	local honey = stats:FindFirstChild("Honey")
	local pollen = stats:FindFirstChild("Pollen")
	if not honey or not pollen then return end

	-- Convert pollen gradually into honey
	task.spawn(function()
		while pollen.Value > 0 do
			local convertAmount = math.min(pollen.Value, math.ceil(CONVERT_RATE * 10))
			pollen.Value -= convertAmount
			honey.Value += convertAmount
			task.wait(CONVERT_INTERVAL)
		end
	end)
end)
